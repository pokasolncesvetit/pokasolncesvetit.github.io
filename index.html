<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>VBA-Excel</title>
 </head>
 <body>


		<style type="text/css">
		BODY {
		background: linear-gradient(90deg, #59c4e4 0%, #fff 100%); /* Параметры фона */
		}
		</style>

<h1>Записи по VBA</h1>

<p>Приветствую тебя на моем сайте посвященному VBA, а точнее VBA под EXCEL.</p>
  
<p>На текущий момент информация является моим черновиком, куда я вносил самые важные примеры команд и описания по взаимодействию применяемые на практике. Надеюсь тебе они тоже будут полезны.<br></p>

 



<p>Sub x()<br>

End - выход внутри макроса<br>

Exit Sub - тоже выход внутри программы<br>

Ctrl+"пробел" - предлагает варианты слов<br>

ActiveWorkbook.FULname - путь к рабочей книге<br>

.copy destination:=Applic...cells(x,y) - вставка без буфера обмена(присвоение)<br>

End sub.<br>

.value свойство объекты - значение из объекта<br>

.byvalue - по значению<br>

Ctrl+G Thisworkbook.close - вызвать окно отладки и закрыть рабочую книгу. Так же можно проверить кусочек макроса без определения переменных и т.д. range("а1") выведет результат в следующей строке окна отладки.<br>

Application - сам excel<br></p>



<p>With a.b<br>

.c<br>

.d.cells и т.д<br>

End With<br></p>



<p>IsNumeric (q) - (true/folse) проверка на число<br>

IsError (q) - (true/folse) проверка на ошибку<br>

IsMissing(q) - (true/folse) проверка на пустоту, если пусто - true<br></p>



<p>Range("D2").FormulaLocal="Целое(А2)" вставляет в д2 формулу<br>

Range("D3").Clear очистить<br>

.ClearContent очистить только содержимое<br>

Х=1 : У=2 - : позволяет записывать комманды в 1 строке<br>

( _) - позволяет продолжить написание кода одной инструкции на следующей строке<br></p>



<p>ReDim MyArray (1 to 6) - перезадаёт тип переменной или размерность массива. Данные удаляются.<br></p>



<p>ReDim Preserve MyArray (1 to 10)- перезадаёт тип переменной или размерность массива. Данные не удаляются.<br></p>



<p>MyArray () - создаёт пустой массив<br></p>



<p>LBound (MyArray) - номер первого элемента массива<br></p>



<p>UBound (MyArray) - номер последнего элемента массива<br></p>

<p>Call Sab Q1(MyArray) - передаёт весь массив<br></p>



<p>If UCase(MyArray(i)) >UCase (MyArray(j)) then... - UCase преобразует текст в верхний регистр<br></p>



<p>Option Compare Text - Добавляется в начало модуля. В этом случае VBA выполняет сравнение строк на основе нечувствительных к регистру правил сортировки. Другими словами, А считается тем же, что и а.<br></p>



<p>Set MyCell = Worksheets ( "Лист1" ) . Range ( "A1" ) - set присваевает переменной сам объект<br></p>



<p>Application.WorksheetFunction - Функции рабочего листа<br></p>



<p>Application.DisplayAlerts =False<br>

Sheets("Имя листа").Copy<br>

ActiveWorkbook.SaveAs X&Y<br>

ActiveWorkbook.close<br>

Application.DisplayAlerts = True<br>

-Сохранение рабочего листа"Имя листа" по пути Х с названием У и последующее закрытие нового листа. Отключаем предупреждающее окно од сохранения, а после включаем заново. Иначе будет возникать диалоговое окно.<br></p>



<p>Static x as integet - статическая переменная не обнуляется при завершении программы<br></p>



<p>Static sub/function переменные не обнуляются при завершении<br></p>



<p>ActiveCell.Offset(1,0).select - смещение по координатам<br></p>



<p>GoSub Метка1 - перенос к метке 1<br>

Метка1: -сама метка, обязательно с двоеточием<br>

Return - вернуться к строке, следующей за GoSub метка1<br></p>



<p>A=Range("a1:b1")<br>

A.Resize(1,1) - расширить диапазон до а2 б2 / A.Resize(1,1).select<br></p>




<p>Worksheets.Count - номер последнего листа<br>

.Count - свойство коллекции, отображающе номер последнего элемента<br></p>



<p>*range(cells(1,1),cells(2,2)).copy _ *range(cells(3,3),cells(4,4))<br>

Вариант копирования "на прямую"<br></p>



<p>F2 - объектный справочник<br></p>



<p>.... Comment Is Nothing - объект равен ""<br>

Empty-""<br></p>



<p>Создание пользовательского класса<br>

Класс создаётся только в модуле<br></p>



<p>Public Type Customerlnfo<br>

Company As S tring<br>

Contact As S tring<br>

RegionCode As Long<br>

Sales As Double<br>

End Type<br></p>



<p>Sub Q123()<br>

Dim Customers (1 То 100) As Customerlnfo<br></p>



<p>Customers(1).Company="AcmeTools"<br>

Customers(1).Contact= "TimRobertson"<br>

Customers(1).RegionCode=3 Customers(1).Sales=150674.98<br></p>



End Sub<br>



<p>чтобы получить список функций VBA при написании кода, введите VBA и точку. После этого VBE отобразит список всех вложенных в объект VBA объектов, включая функции. Функции обозначаются зеленым значком.<br>

Чтобы использовать функцию Excel в операторе VBA, перед названием функции введите следующее выражение:<br>

Application.WorksheetFunction<br>

Пример<br>

WorksheetFunction.IsNumber(X)<br></p>



<p>Конструкция For Each<br>

Sub CountSheets()<br>

Dim Item as Worksheet<br>

For Each Item In ActiveWorkbook.Worksheets<br>

MsgBox Item.Name<br>

Next Item<br>

End Sub<br></p>



<p>Exit For - выход из цикла For<br></p>



<p>Пример конструкции GoTo<br>

Sub GoToDemo()<br>

UserName = InputBox ("Введите свое имя :")<br>

If UserName <> "Ховард" Then GoTo WrongName<br>

MsgBox ("Привет, Х о в а р д ...")<br>

Exit Sub<br>

WrongName:<br>

MsgBox "Извините, эту процедуру может запускать только Ховард."<br>

End Sub<br></p>



<p>Пример конструкции If Then ElseIf Else End If<br>

Обязаьельные только If Then End If<br>

Sub QWE()<br>

Dim X As Integer<br>

X = InputBox("")<br>

If X < 1 Then<br>

MsgBox ("<1")<br>

ElseIf X < 2 Then<br>

MsgBox ("<2")<br>

ElseIf X < 3 Then<br>

MsgBox ("3")<br>

Else<br>

MsgBox ("ENOT")<br>

End If<br>

End Sub<br></p>



<p>Пример конструкции Case<br>

В операторе Case можно использовать запятую, разделяющую несколько значений для одного варианта.<br>

Если вы используете вкаждом случае Case только одну инструкцию (как в предыдущем примере), то можете поместить ее в той же строке, что и ключевое слово Case (но не забудьте о символе раз­ деления операторов в VBА — двоеточие :)<br>

Возможно в конструкции использовать вложенный select case после case верхнего уровня, но его нужно будет закрыть своим end select.<br>

Sub G reetM e()<br>

Dim Msg As S trin g<br>

Select Case Time<br>

Case Is < 0.5<br>

MsgBox = "Доброе утро": MsgBox = "Доброе утро"<br>

Case is <0.4<br>

MsgBox ="Енот"<br>

Case Is 0.4, 0.3, 0.2<br>

MsgBox = "Енот2"<br>

Case 0.5 To 0.75<br>

Msg = "Добрый день"<br>

Case Else<br>

Msg = "Добрый вечер"<br>

End Select<br>

MsgBox Msg<br>

End Sub<br></p>



<p>Пример цикла for i = 9 to 6 Step -1 (любое положительное и отрицательное)<br></p>



<p>Next i<br>

Или<br>

Sub SumOddSquareRoots()<br>

Dim Sum As Double<br>

Dim Count As Integer<br>

Sum = 0<br>

For Count = 1 To 100 Step 2<br>

Sum = Sum + Sqr(Count)<br>

Next Count<br>

MsgBox Sum<br>

End Sub<br></p>



<p>Пример метода Find для поиска максимального значения в столбце.<br>

Range("А :А").Find (Application.WorksheetFunction.Max _ (Range("A :A"))).Activate<br></p>



<p>Application.ScreenUpdeting = True/False<br>

Включение и отключение обновления Экрана<br></p>



<p>Application.run - позволяет вызвать макрос, аналог Call<br></p>



<p>Sub q1(ByVal x as integer)<br>

If x> then<br>

MsgBox ("x>5")<br>

End If<br>

End Sub<br></p>



<p>Sub q2 ()<br>

Dim t as integer<br>

t = InputBox ("")<br>

Application.run "module1.q1", 1<br>

Application.run "ЭтаКнига.q1", 1<br>

Application.run "Книга321.xlsm!ЭтаКнига.q1", 1<br>

End Sub<br>

Application.Run " 'budget macros.xlsm '! q1"<br>

Call module1.("название макроса")- ссылка на программу в другом модуле, если имеются одинаковые названия. Вызвать макрос типа private можно только из его модуля или листа, или книге (объекта где он написан)<br></p>



<p>Вызов процедуры из другой рабочей книги<br></p>

В некоторых случаях необходимо, чтобы процедура выполняла иную процедуру, определенную в другой рабочей книге. Для этого существует два варианта: установить ссылку на другуюрабочую книгу или использовать метод Run и явно указать название рабочей книги.<br>

Чтобы добавить ссылку на другую рабочую книгу, выберите в VBE команду Tooted References (Сервис=>Ссылки). Будет отображено диалоговое окно References (Ссылки), в котором перечислены все существующие ссылки во всех открытых рабочих книгах. Выставьте флажок, соответствующий той рабочей книге, на которую вы планируете добавить ссылку, и щелкните на кнопке ОК. После установки ссылки процедуры в этой рабочей книге можно вызывать так, будто они находятся в текущей рабочей книге, к которой принадлежит вызывающая процедура.<br>

Рабочая книга, на которую ссылаются, не обязательно должна быть открыта — она рассматривается как отдельная библиотека объектов. Используйте кнопку Browse (Просмотр) вдиалоговом окне References, чтобы установить ссылку на закрытую рабочую книгу.<br></p>



<p>Debug.print x - отобразть значение переменной x в окне отладки<br></p>



<p>Sub q1(ByVal x as integer) - ByVal позволяет передавать переменную по значению, т.е. мы будем работать с копией переменной, и не сможем её изменить в исходной программе. Если не указать ByVal, то переменная передаётся по ссылке, и любые ищменения отразятся в исходной программе, или если переменной присвоен объект, то и в объекте<br></p>



<p>Перехват ошибок<br>

1) переход к метке FOX при возникновении ошибки<br>

Sub Test()<br>

On Error GoTo FOX<br>

Worksheets(2).Select<br>

Exit Sub<br>

FOX:<br>

MsgBox ("Yes, i am fox")<br>

End Sub<br>

2) игнорирование ошибки. В случе её возникновения, код продолжает выполняться дальше.<br>

Sub Test2()<br>

On Error Resume Next<br>

Worksheets(2).Select<br>

End Sub<br></p>



<p>On Error Resume Next<br>

SheetCount = ActiveWorkbook.Sheets.Count If Err <> 0 Then Exit Sub - Если Err не равно нулю, это означает, что произошла ошибка. Следовательно, процедура заканчивается.<br></p>



<p>If ActiveWorkbook Is Nothing Then Exit Sub - Если активная книга свёрнута(нет активной книги), то выход из макроса.<br></p>



<p>'Проверка защиты структуры рабочей книги<br>

If ActiveWorkbook.ProtectStructure Then MsgBox ActiveWorkbook.Name & "защищена.", _<br>

vbCritical, "Сортировка листов невозможна."<br>

Exit Sub<br>

End If<br></p>



<p>Set OldActive=ActiveSheet - присваивает переменной активный рабочий лист<br>

OldActive.Activate - активизирует рабочий лист, который был изначально активным<br></p>



<p>X =Len("Fox") 'результат =3<br>

Len - количество символов<br></p>



<p> Like "[ABC]" - Like ищет А в диапозоне, в данном случае True.<br>

Вариантов много, ищи в справке.<br></p>



<p>Mid(строка,начальная позиция, длина) - аналог пстр<br></p>



<p>Sub Test1()<br>

Dim x As Variant<br>

x = InStr("На горе Фернандо-По, где гуляет Гиппо-по", "Фернандо")<br>

MsgBox x<br>

'Здесь x будет равен 9<br>

End Sub<br></p>



<p>Function RemoveVowels(qwe) As String<br>

'Удаляет все гласные буквы из текста<br>

Dim i As Long<br>

RemoveVowels = ""<br>

For i = 1 To Len(qwe)<br>

If Not UCase(Mid(qwe, i, 1)) Like "[AEIOUАЕОУЫЭЮЯ]" Then<br>

RemoveVowels = RemoveVowels & Mid(qwe, i, 1)<br>

End If<br>

Next i<br>

End Function<br></p>



<p>Total = RemoveVowels (X) - вызов функции и передача аргумента Х. Функцию можно вызвать и без "тотал".<br></p>



<p>Asc (L) - возвращает номер символа<br>

Chr (23) - возвращает символ по номеру<br>

Application.Path - адрес к папке, где установлен Excel<br></p>



<p>Rnd() - возвращает случайное число между (1;0)<br></p>



<p>MsgBox "Ваше имя" &User() - пример вызова функции в макросе<br></p>



<p>Application.Volatile True - указывается в теле функции для более частого пересчёта<br></p>



<p>Select Case a<br>

Case 0 To 99<br>

MsgBox ("DA")<br>

End Select - проверка на вхождение в диапазон 0 to 99<br></p>



<p>Function User(Optional Uppercase As Variant)<br>

If IsMissing(Uppercase) Then Uppercase = False<br>

User = Application.UserName<br>

If Uppercase Then User = UCase(User)<br>

End Function<br>

Optional Uppercase As Variant - optional указывается перед необязательным аргументом, необязательный аргумент всегда последний<br></p>



<p>Function User(Optional Uppercase As Variant = true(или любое другое значение)) - = true это значение, которое присваевается переменной, по умолчанию, если она не определена (пуста)<br></p>



<p>Function MonthName()<br>

MonthName = Array("Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек")<br>

End Function<br>

- Функция создаёт горизонтальный массив, вводится ctrl + shift + enter<br></p>



<p>(A+B) mod C - mod остаток от деления А+В на С<br></p>



<p>Чтобы получить ошибку #Н/Д в пользовательской функции, примените следующий оператор: Х = CVErr(xlErrNA)<br>

xlErrDivO (для ошибки #ДЕЛ/ 0 !);<br>

xlErrNA (для ошибки #Н/Д);<br>

xlErrName (для ошибки #ИМЯ?);<br>

xlErrNull (для ошибки #ПУСТО !);<br>

xlErrNum (для ошибки #ЧИСЛО !);<br>

xlErrRef (для ошибки #ССЫЛ !);<br>

xlErrValue (для ошибки #ЗНАЧ !).<br></p>

 

<p>Вы можете присоединиться к нашей группе ВКонтакте: https://vk.com/vba_for_excel <br></p>

<p>Для индексации: vba vba excel vba ячейка vba строки vba массивы vba функции <br></p>
<p>vk.com/vba_for_excel</p>

 </body>
</html>
